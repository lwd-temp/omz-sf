cat <<END >$ZSH_PLUGLOADER
#!/bin/zsh
plugins=()
while read -r line; do
    if [[ "\$line" != '#'* ]]; then
        read -A list <<<"\$line"
        plugins+=("\${list[@]}")
    fi
done <$ZSH_PLUGLOADER_LIST
END

if [ "$ADD_RECOMMENDED_PLUGINS" = 1 ]; then
   scripts/add-recommended-plugins
else
   touch $ZSH_PLUGLOADER_LIST
fi

sed -i "s#plugins=(git)\$#source \"$ZSH_PLUGLOADER\"#" ~/.zshrc
echo "• Plugins dynamic loader: $ZSH_PLUGLOADER"
echo "• Plugins static list: $ZSH_PLUGLOADER_LIST"
echo
